<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Count Regression • appregr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Count Regression">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">appregr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/count-regression-bayesian-vignette.html">Count Regression Part II - Bayesian Approaches</a>
    </li>
    <li>
      <a href="../articles/count-regression-hierarchical-mixedeffect-partII-vignettes.html">Count Regression Part III - Heirarchical / Mixed Effects</a>
    </li>
    <li>
      <a href="../articles/count-regression-hierarchical-mixedeffects-vignette.html"> Heirarchical / Mixed Effects</a>
    </li>
    <li>
      <a href="../articles/count-regression-vignette.html">Count Regression</a>
    </li>
    <li>
      <a href="../articles/regression-diagnositcs-vignette.html">regression-diagnostics-vignette</a>
    </li>
    <li>
      <a href="../articles/regression-numerical-linalg-vignette.html">regression-numerical-linalg-vignette</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Count Regression</h1>
            <h3 class="subtitle">A tutorial on count regression</h3>
                        <h4 class="author">Bruce Campbell</h4>
            
            <h4 class="date">25 July, 2019</h4>
      
      
      <div class="hidden name"><code>count-regression-vignette.Rmd</code></div>

    </div>

    
    
<p>##Count regression review</p>
<p>There are three basic types of count regression - Poisson, Binomial, and negative binomial. The Poisson distribution falls in the class of exponential family. For a fixed number of trials - Binomial and negative binomial distributions fall under the exponential family as well. These basic count models fall in the class of generalized linear model (GLM) and can all be fit in R using the <code>glm</code> function. Counts with a large number of zeros can also be modeled as a mixture of a count and a Bernoulli distribution. These mixture responses are called Zero-Inflated models and can be fit in R using the <code>zeroinfl</code> function from the <code>pscl</code> package.</p>
A (GLM) consists of three components:

<p>The systematic component, <span class="math inline">\(\eta_i = x_i \cdot \beta\)</span> is linear in the predictors so many of the concepts from linear modeling carry over to generalized linear modeling. This means that model specification and interpretation is the same. The main difference is the link function and the response.</p>
<p>An observation <span class="math inline">\(Y_i\)</span> over an interval <span class="math inline">\(j\)</span> follows a Poisson distribution if <span class="math inline">\(P(Y_i=n)= \frac{\lambda_i^n}{n!}e^{-\lambda_i}\)</span>. We often decompose <span class="math inline">\(\lambda\)</span> into fixed <span class="math inline">\(\theta\)</span> and random <span class="math inline">\(\eta_i\)</span> effects, <span class="math inline">\(\lambda_i=\theta e^{\eta_i}\)</span>. A key aspect of a Poisson model is that after accounting for the effect of predictors, the mean must equal the variance. If the mean does not equal the variance, then a transformation might be appropriate or we may need to seek a count response with a better fit like a negative binomial. Another option is to add a dispersion parameter to a Poisson model. We say that our data is over-dispersed when the variance is larger than the mean in our dependent variable. Over-dispersion is a problem if the conditional (residual) variance is larger than the conditional mean. Running an over-dispersed Poisson model will generate understated standard errors. Understated standard errors can lead to erroneous conclusions.</p>
<p>The negative binomial response is described by series of independent trials, each with a probability of success <span class="math inline">\(p\)</span>, <span class="math inline">\(Z\)</span> be the number of trials until the <span class="math inline">\(k\)</span> th success. Then: <span class="math display">\[P(Z = z) = \binom{z-1}{k-1}p^k (1- p)^{z-k} \;\;\; z = k, k +1, \cdots\]</span> For regression is is usually reparametrized <span class="math inline">\(Y = Z -k\)</span> and <span class="math inline">\(p = \frac{1}{1+\alpha}\)</span> then <span class="math display">\[P(Y = y) =  \binom{y+k-1}{k -1}\frac{\alpha^y}{(1+\alpha)^{y+k}}\]</span> Then we have the convenient representation for the mean and variance <span class="math inline">\(E[Y] = \mu = k \alpha\)</span> and <span class="math inline">\(var(Y) = k \alpha+k \alpha^2 = \mu+\frac{\mu^2}{k}\)</span>.</p>
<p>There are two ways to check for over-dispersion; the Pearson <span class="math inline">\(\chi^2\)</span> , and via the dispersion statistic calculated by R. If the variance is equal to the mean, the dispersion statistic would equal one. When the dispersion statistic is larger than one, a negative binomial model may fit better. <span class="citation">(Cameron 2012)</span> recommended using robust standard errors for the parameter estimates to control for mild violation of the distribution assumption that the variance equals the mean. The R package <code>sandwich</code> can be used to obtain robust standard errors and calculated the p-values.</p>
<p>There are methods of eliminating or reducing the over-dispersion of the data. Scaling the standard errors and re-weighting the model weight with the inverse square root of the dispersion statistic is one approach. We need to run the model twice - once to calculate the dispersion statistic and a second time with the adjusted weights (standard errors are multiplied by the square root of the dispersion).</p>
<p>The question of choosing between an overdispersed Poisson and a negative binomial model is a little more subtle. <span class="citation">(Ver Hoef and Boveng 2007)</span> work out the details of the differences between quasi-Poisson and negative binomial models. The variance of a quasi-Poisson model is a linear function of the mean <span class="math inline">\(var(Y)=\phi \; \eta=\phi \; x_i \cdot \beta\)</span>, $while the variance of a negative binomial model is a quadratic function of the mean <span class="math inline">\(var(Y) = k \alpha+k \alpha^2 = \mu+\frac{\mu^2}{k}\)</span>. These variance relationships affect the weights in the iteratively weighted least-squares (IRLS) algorithm of fitting models to data. Because the variance is a function of the mean, large and small counts get weighted differently in quasi-Poisson and negative binomial regression.</p>
<p>Count data are essentially measures of frequency. There’s a connection between counts and time to events. We see this in the relationinship between the exponential and Poisson distribution. Let <span class="math inline">\(N_t\)</span> be the number of events during time period <span class="math inline">\(t\)</span>, and <span class="math inline">\(X_t\)</span> the time it takes for one additional event to arrive assuming that there was an event at time <span class="math inline">\(t\)</span> i.e. <span class="math inline">\((X_t&gt; x) \implies (N_t=N_{t+x})\)</span> The event on the left captures the condtion that no event occurs in the time interval <span class="math inline">\([t,t+x]\)</span> which implies that our count of the number of events at time <span class="math inline">\(t+x\)</span> is identical to the count at time t which is the event on the right. Now using <span class="math inline">\(P(X_t \leq x)=1-P(X_t&gt;x)\)</span> and the above we can write <span class="math inline">\(P(X_t &gt; x)=1-P(N_{t+x}-N_t=0\)</span>. Since <span class="math inline">\(P(N_{t+x}-N_t=0)=P(N_x=0)\)</span> Now let <span class="math inline">\(P\)</span> be a Poisson pmf the above where <span class="math inline">\(\lambda\)</span> is the averx number of events per time unit and <span class="math inline">\(x\)</span> a quantity of time units, then <span class="math inline">\(P(N_{t+x}-N_t=0)=\frac{\lambda x^0}{0!} e^{-\lambda x}=e^{-\lambda x}\)</span> Writing another way <span class="math inline">\(P(X_t \leq x)=1-e^{-\lambda x}\)</span> which is the cdf of a exponential random variable.</p>
<p>Count data are intrinsically event frequency measures. There is a connection with repeated time to event processes. Events are binned within time intervals for a variety of practical reasons. Time intervals are generally of fixed length, but this is not necessarily always the case. Count data can be viewed as driven by an underlying hazard, where the hazard is the instantaneous rate of the events. Investigating how the hazard varies with covariates is one of the points of count modeling. If the hazard is time-varying, then binning events in time intervals dilutes information. In this case, we may - and often will be- better off fitting time to events model.</p>
<p>Looking at <span class="math inline">\(\lambda\)</span> as a piecwise constant rate function allows us to establish the relationship between the Poisson and hazard model. Focusing on the probability of a zero event within an interval <span class="math inline">\([t_{j-1},t_j]\)</span> when the hazard is known and constant. We have <span class="math display">\[P(Y_i=0 \in [t_{j-1},t_j])=e^{-\lambda_i}\]</span> which can also be written in terms of the hazard function <span class="math display">\[P(Y_i=0)=S(t_j)=e^{-\int_{t_{j-1}}^{t_j}h_i(u) du} = e^{ h_i (t_j-t_{j-1})}\]</span> @[Holford] showed the mathematical equivalence between piecewise hazard models and the Poisson count regression.</p>
<p>#Univariate Count Model - <span class="math inline">\(y \sim x\)</span></p>
<p>In this section, we fit count models to the synthetic equidispersed Poisson data. After looking at the baseline models, we investigate how overdispersed and zero-inflated data is fit.</p>
<div id="generate-equidispersed-poisson-count-data" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-equidispersed-poisson-count-data" class="anchor"></a>Generate equidispersed Poisson count data</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># sample size</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># regression coefficients</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">beta0 &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">beta1 &lt;-<span class="st"> </span><span class="fl">0.2</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"># generate covariate values</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dt">n =</span> n, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co"># compute mu's</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">mu &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(beta0 <span class="op">+</span><span class="st"> </span>beta1 <span class="op">*</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co"># generate Y-values</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">rpois</a></span>(<span class="dt">n =</span> n, <span class="dt">lambda =</span> mu)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># data set</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">modelling_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw">pander</span>(<span class="kw">summarize</span>(modelling_data), <span class="dt">caption =</span> <span class="st">"Synthtic Data : Summary Statistics"</span>)</a></code></pre></div>
<table class="table">
<caption>Synthtic Data : Summary Statistics</caption>
<colgroup>
<col width="5%">
<col width="9%">
<col width="4%">
<col width="9%">
<col width="9%">
<col width="4%">
<col width="8%">
<col width="9%">
<col width="12%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th></th>
<th align="center">N</th>
<th></th>
<th align="center">Mean</th>
<th align="center">SD</th>
<th></th>
<th align="center">Min</th>
<th align="center">Q1</th>
<th align="center">Median</th>
<th align="center">Q3</th>
<th align="center">Max</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>y</td>
<td align="center">1000</td>
<td></td>
<td align="center">8.66</td>
<td align="center">5.54</td>
<td></td>
<td align="center">0</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">12</td>
<td align="center">27</td>
</tr>
<tr class="even">
<td>x</td>
<td align="center">1000</td>
<td></td>
<td align="center">4.97</td>
<td align="center">2.92</td>
<td></td>
<td align="center">0</td>
<td align="center">2.32</td>
<td align="center">4.9</td>
<td align="center">7.46</td>
<td align="center">10</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> modelling_data) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">univariate.features &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">univariate.model.formula &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/formula">as.formula</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"y ~ "</span>, univariate.features[i], </a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="dt">sep =</span> <span class="st">""</span>))</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">model.string &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"poisson univariate "</span>, univariate.model.formula, <span class="dt">sep =</span> <span class="st">""</span>)</a></code></pre></div>
<p>###Fit Poisson model of <span class="math inline">\(y \sim x\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">m1.poisson &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(univariate.model.formula, <span class="dt">data =</span> modelling_data, <span class="dt">family =</span> poisson)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">pander</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.poisson))</a></code></pre></div>
<table class="table">
<colgroup>
<col width="25%">
<col width="15%">
<col width="18%">
<col width="13%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">1.046</td>
<td align="center">0.02839</td>
<td align="center">36.86</td>
<td align="center">2.293e-297</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1928</td>
<td align="center">0.004031</td>
<td align="center">47.84</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>(Dispersion parameter for poisson family taken to be 1 )</p>
<table class="table">
<colgroup>
<col width="29%">
<col width="37%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center">Null deviance:</td>
<td align="center">3557 on 999 degrees of freedom</td>
</tr>
<tr class="even">
<td align="center">Residual deviance:</td>
<td align="center">1050 on 998 degrees of freedom</td>
</tr>
</tbody>
</table>
<p>Looking at the predicted counts and doing some QA on our understanding of the model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">beta_<span class="dv">0</span> &lt;-<span class="st"> </span>m1.poisson<span class="op">$</span>coefficients[<span class="st">"(Intercept)"</span>]</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">beta_<span class="dv">1</span> &lt;-<span class="st"> </span>m1.poisson<span class="op">$</span>coefficients[<span class="st">"x"</span>]</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">predicted.counts.irr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(<span class="dt">object =</span> m1.poisson))</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">calculated.predicted.irr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(beta_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>beta_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>modelling_data<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co"># ggplot(data=data.frame(predicted.counts=predicted.counts.irr,</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># calculated.predicted=calculated.predicted.irr),aes(x=calculated.predicted.irr,y=predicted.counts.irr))+geom_point()+ggtitle('QA</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co"># plot - predicted versus hand calculated counts in rr scale')</span></a></code></pre></div>
</div>
<div id="fitting-a-negative-binomial-model-" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-a-negative-binomial-model-" class="anchor"></a>Fitting a negative binomial model.</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">m1.negbin &lt;-<span class="st"> </span><span class="kw">glm.nb</span>(univariate.model.formula, <span class="dt">data =</span> modelling_data)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(m1.negbin)</a></code></pre></div>
<pre><code>
Call:  glm.nb(formula = univariate.model.formula, data = modelling_data, 
    init.theta = 26997.57846, link = log)

Coefficients:
(Intercept)            x  
     1.0463       0.1929  

Degrees of Freedom: 999 Total (i.e. Null);  998 Residual
Null Deviance:      3556 
Residual Deviance: 1049     AIC: 4827</code></pre>
<p>The Poisson and negative binomial (NB) model are nested: Poisson is a particular case with <span class="math inline">\(\theta = \infty\)</span>. So a likelihood ratio test comparing the two models is testing the null hypothesis that <span class="math inline">\(\theta = \infty\)</span> against the alternative that <span class="math inline">\(\theta &lt; \infty\)</span>.</p>
<p>The form of the model equation for negative binomial regression is the same as that for Poisson regression. The log of the outcome is predicted with a linear combination of the predictors. The coefficients have an additive effect in the <span class="math inline">\(ln(Y)\)</span> scale and the incident rate ratios (IRR) have a multiplicative effect in the <span class="math inline">\(Y\)</span> scale. The dispersion parameter in negative binomial regression does not affect the expected counts, but it does change the estimated variance of the expected counts.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">pander</span>(<span class="kw">lrtest</span>(m1.poisson, m1.negbin), <span class="dt">caption =</span> <span class="st">"LRT : Poisson vs Negative Binomial"</span>)</a></code></pre></div>
<table class="table">
<caption>LRT : Poisson vs Negative Binomial</caption>
<colgroup>
<col width="8%">
<col width="12%">
<col width="6%">
<col width="13%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">#Df</th>
<th align="center">LogLik</th>
<th align="center">Df</th>
<th align="center">Chisq</th>
<th align="center">Pr(&gt;Chisq)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2</td>
<td align="center">-2410</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">-2410</td>
<td align="center">1</td>
<td align="center">0.00221</td>
<td align="center">0.9625</td>
</tr>
</tbody>
</table>
<p>We apply a Vuong <span class="citation">(Vuong 1989)</span> test of Poisson versus negative binomial models. Although the typical application of this test is for non-nested models, it should still be a valid way to compare the Poisson and negative binomial models. The Vuong non-nested test is based on a comparison of the predicted probabilities of two models that do not nest. Under the null that the models are indistinguishable, the test statistic is asymptotically distributed standard normal. The function will fail if the models do not contain identical values in their respective components named y (the value of the response being modeled) - hence it’s usefulness for comparing count regression models.</p>
<p>A large, positive test statistic provides evidence of the superiority of model 1 over model 2, while a large, negative test statistic is evidence of the superiority of model 2 over model 1.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">vuong</span>(m1.poisson, m1.negbin)</a></code></pre></div>
<pre><code>Vuong Non-Nested Hypothesis Test-Statistic: 
(test-statistic is asymptotically distributed N(0,1) under the
 null that the models are indistinguishible)
-------------------------------------------------------------
              Vuong z-statistic             H_A p-value
Raw                   0.1415046 model1 &gt; model2 0.44374
AIC-corrected         0.1415046 model1 &gt; model2 0.44374
BIC-corrected         0.1415046 model1 &gt; model2 0.44374</code></pre>
</div>
<div id="we-can-get-the-confidence-intervals-for-the-coefficients-by-profiling-the-likelihood-function-" class="section level3">
<h3 class="hasAnchor">
<a href="#we-can-get-the-confidence-intervals-for-the-coefficients-by-profiling-the-likelihood-function-" class="anchor"></a>We can get the confidence intervals for the coefficients by profiling the likelihood function.</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">est.poisson &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="dt">Estimate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson), <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint</a></span>(m1.poisson))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">pander</span>(est.poisson, <span class="dt">caption =</span> <span class="st">"Poisson"</span>)</a></code></pre></div>
<table class="table">
<caption>Poisson</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">2.5 %</th>
<th align="center">97.5 %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">1.046</td>
<td align="center">0.9904</td>
<td align="center">1.102</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1928</td>
<td align="center">0.185</td>
<td align="center">0.2008</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">est.negbin &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="dt">Estimate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.negbin), <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint</a></span>(m1.negbin))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">pander</span>(est.negbin, <span class="dt">caption =</span> <span class="st">"negative binomial"</span>)</a></code></pre></div>
<table class="table">
<caption>negative binomial</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">2.5 %</th>
<th align="center">97.5 %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">1.046</td>
<td align="center">0.9904</td>
<td align="center">1.102</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1929</td>
<td align="center">0.185</td>
<td align="center">0.2008</td>
</tr>
</tbody>
</table>
</div>
<div id="exponentiating-the-coefficients-gives-us-the-incident-rate-ratios-" class="section level3">
<h3 class="hasAnchor">
<a href="#exponentiating-the-coefficients-gives-us-the-incident-rate-ratios-" class="anchor"></a>Exponentiating the coefficients gives us the incident rate ratios.</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">pander</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(est.poisson), <span class="dt">caption =</span> <span class="st">"incident rate ratios poisson"</span>)</a></code></pre></div>
<table class="table">
<caption>incident rate ratios poisson</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="11%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">2.5 %</th>
<th align="center">97.5 %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">2.847</td>
<td align="center">2.692</td>
<td align="center">3.009</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">1.213</td>
<td align="center">1.203</td>
<td align="center">1.222</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">pander</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(est.negbin), <span class="dt">caption =</span> <span class="st">"incident rate ratios negative binominal"</span>)</a></code></pre></div>
<table class="table">
<caption>incident rate ratios negative binominal</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="11%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">2.5 %</th>
<th align="center">97.5 %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">2.847</td>
<td align="center">2.692</td>
<td align="center">3.009</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">1.213</td>
<td align="center">1.203</td>
<td align="center">1.222</td>
</tr>
</tbody>
</table>
</div>
<div id="the-residual-versus-fitted-" class="section level3">
<h3 class="hasAnchor">
<a href="#the-residual-versus-fitted-" class="anchor"></a>The residual versus fitted.</h3>
<p>Plotting the standardized deviance residuals to the predicted counts is another method of determining which model, Poisson or negative binomial, is a better fit for the data. The series of waves in the graph is not an unusual structure when graphing count model residuals and predicted outcomes. A good fitting model will have the majority of the points between negative 2 and positive 2 on the y-axis. There should be few points below negative 3 and above positive 3.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">plotTitle &lt;-<span class="st"> </span><span class="kw">TeX</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"residuals vs fitted : $$"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"_"</span>, <span class="st">"-"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(univariate.model.formula)), </a>
<a class="sourceLine" id="cb15-2" data-line-number="2">    <span class="st">"$$ model = glm poisson"</span>, <span class="dt">sep =</span> <span class="st">""</span>))</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">fitted =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(m1.poisson), <span class="dt">residuals =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.poisson))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> fitted, <span class="dt">y =</span> residuals)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(plotTitle)</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">plotTitle &lt;-<span class="st"> </span><span class="kw">TeX</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"residuals vs fitted : $$"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"_"</span>, <span class="st">"-"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(univariate.model.formula)), </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">    <span class="st">"$$ model = MASS glm.nb Negative Binomial"</span>, <span class="dt">sep =</span> <span class="st">""</span>))</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">fitted =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(m1.negbin), <span class="dt">residuals =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.negbin))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> fitted, <span class="dt">y =</span> residuals)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(plotTitle)</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<p>###Looking at the robust SE corrected Poisson coefficients provided by the <code>sandwich</code> package</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sandwich)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">cov.m1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sandwich/topics/vcovHC">vcovHC</a></span>(m1.poisson, <span class="dt">type =</span> <span class="st">"HC0"</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">std.err &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(cov.m1))</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">r.est &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="dt">Estimate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson), <span class="st">`</span><span class="dt">Robust SE</span><span class="st">`</span> =<span class="st"> </span>std.err, <span class="st">`</span><span class="dt">Pr(&gt;|z|)</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">pnorm</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson)<span class="op">/</span>std.err), <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>), <span class="dt">LL =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="st">    </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>std.err, <span class="dt">UL =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>std.err)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="kw">pander</span>(r.est, <span class="dt">caption =</span> <span class="st">"SE corrected coefficients"</span>)</a></code></pre></div>
<table class="table">
<caption>SE corrected coefficients</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="16%">
<col width="18%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Robust SE</th>
<th align="center">Pr(&gt;|z|)</th>
<th align="center">LL</th>
<th align="center">UL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">1.046</td>
<td align="center">0.02813</td>
<td align="center">7.013e-303</td>
<td align="center">0.9912</td>
<td align="center">1.101</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1928</td>
<td align="center">0.003953</td>
<td align="center">0</td>
<td align="center">0.1851</td>
<td align="center">0.2006</td>
</tr>
</tbody>
</table>
</div>
<div id="fitting-an-overdispersed-poisson--the-dispersion-parameter-phi-may-be-estimated-" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-an-overdispersed-poisson--the-dispersion-parameter-phi-may-be-estimated-" class="anchor"></a>Fitting an overdispersed Poisson. The dispersion parameter <span class="math inline">\(\phi\)</span> may be estimated.</h3>
<p><span class="math display">\[\phi=\frac{X^2}{n-p} = \frac{\sum (y_i- \hat\mu_i)^2 / \hat\mu_i}{n-p}\]</span></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">dp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.poisson, <span class="dt">type =</span> <span class="st">"pearson"</span>)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>m1.poisson<span class="op">$</span>df.res</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(dp) &lt;-<span class="st"> "dispersion parameter"</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">dp</a></code></pre></div>
<pre><code>dispersion parameter 
            1.000702 </code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.poisson, <span class="dt">dispersion =</span> dp)</a></code></pre></div>
<pre><code>
Call:
glm(formula = univariate.model.formula, family = poisson, data = modelling_data)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-3.05384  -0.73679  -0.04463   0.63152   2.80036  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 1.046338   0.028399   36.84   &lt;2e-16 ***
x           0.192849   0.004032   47.83   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1.000702)

    Null deviance: 3557.0  on 999  degrees of freedom
Residual deviance: 1049.8  on 998  degrees of freedom
AIC: 4824.6

Number of Fisher Scoring iterations: 4</code></pre>
<p>Notice that the estimation of the dispersion and the regression parameters is independent, so choosing a dispersion other than one has no effect on the regression parameter estimates.</p>
<p>We can also achieve the same effect by fitting a quasi-Poisson model directly using <code>glm</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">m1.quasipoisson &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(univariate.model.formula, <span class="dt">data =</span> modelling_data, <span class="dt">family =</span> quasipoisson)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.quasipoisson)</a></code></pre></div>
<pre><code>
Call:
glm(formula = univariate.model.formula, family = quasipoisson, 
    data = modelling_data)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-3.05384  -0.73679  -0.04463   0.63152   2.80036  

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1.046338   0.028400   36.84   &lt;2e-16 ***
x           0.192849   0.004032   47.83   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasipoisson family taken to be 1.000712)

    Null deviance: 3557.0  on 999  degrees of freedom
Residual deviance: 1049.8  on 998  degrees of freedom
AIC: NA

Number of Fisher Scoring iterations: 4</code></pre>
<p>We can not compare the quasi-Poisson and negative binomial models. The former is not fit using maximum likelihood, hence the Vuong test, which is a likelihood ratio based test, fails.</p>
</div>
<div id="zero-inflated-models" class="section level2">
<h2 class="hasAnchor">
<a href="#zero-inflated-models" class="anchor"></a>zero-inflated models</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">m1.poisson.zi &lt;-<span class="st"> </span><span class="kw">zeroinfl</span>(univariate.model.formula, <span class="dt">data =</span> modelling_data, <span class="dt">dist =</span> <span class="st">"poisson"</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"></a>
<a class="sourceLine" id="cb24-3" data-line-number="3">m1.negbin.zi &lt;-<span class="st"> </span><span class="kw">zeroinfl</span>(univariate.model.formula, <span class="dt">data =</span> modelling_data, <span class="dt">dist =</span> <span class="st">"negbin"</span>)</a>
<a class="sourceLine" id="cb24-4" data-line-number="4"></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.poisson.zi))</a></code></pre></div>
<pre><code>
Call:
zeroinfl(formula = univariate.model.formula, data = modelling_data, 
    dist = "poisson")

Pearson residuals:
     Min       1Q   Median       3Q      Max 
-2.42823 -0.70628 -0.04063  0.65261  3.26810 

Count model coefficients (poisson with log link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 1.048459   0.029931   35.03   &lt;2e-16 ***
x           0.192579   0.004209   45.75   &lt;2e-16 ***

Zero-inflation model coefficients (binomial with logit link):
            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)  -4.8130     4.7644  -1.010    0.312
x            -0.9657     1.2421  -0.777    0.437
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Number of iterations in BFGS optimization: 10 
Log-likelihood: -2410 on 4 Df</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.negbin.zi))</a></code></pre></div>
<pre><code>
Call:
zeroinfl(formula = univariate.model.formula, data = modelling_data, 
    dist = "negbin")

Pearson residuals:
     Min       1Q   Median       3Q      Max 
-2.42835 -0.70473 -0.04444  0.65479  3.27260 

Count model coefficients (negbin with log link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.04638    0.02838  36.872   &lt;2e-16 ***
x            0.19284    0.00403  47.857   &lt;2e-16 ***
Log(theta)  11.09800   44.83116   0.248    0.804    

Zero-inflation model coefficients (binomial with logit link):
            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)  -9.0997         NA      NA       NA
x            -0.8365     7.9348  -0.105    0.916
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Theta = 66038.7941 
Number of iterations in BFGS optimization: 23 
Log-likelihood: -2410 on 5 Df</code></pre>
<p>Fitted versus residuals for the zero-inflated class of model.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.poisson.zi) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(m1.poisson.zi), <span class="dt">pch =</span> <span class="st">"."</span>, <span class="dt">main =</span> <span class="kw">TeX</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"residuals vs fitted : $$"</span>, </a>
<a class="sourceLine" id="cb28-2" data-line-number="2">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"_"</span>, <span class="st">"-"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(univariate.model.formula)), <span class="st">"$$ model = zeroinfl poisson"</span>, </a>
<a class="sourceLine" id="cb28-3" data-line-number="3">    <span class="dt">sep =</span> <span class="st">""</span>)))</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.negbin.zi) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(m1.negbin.zi), <span class="dt">pch =</span> <span class="st">"."</span>, <span class="dt">main =</span> <span class="kw">TeX</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"residuals vs fitted : $$"</span>, </a>
<a class="sourceLine" id="cb29-2" data-line-number="2">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"_"</span>, <span class="st">"-"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(univariate.model.formula)), <span class="st">"$$ model = zeroinfl negative binomial"</span>, </a>
<a class="sourceLine" id="cb29-3" data-line-number="3">    <span class="dt">sep =</span> <span class="st">""</span>)))</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw">vuong</span>(m1.poisson.zi, m1.negbin.zi))</a></code></pre></div>
<pre><code>Vuong Non-Nested Hypothesis Test-Statistic: 
(test-statistic is asymptotically distributed N(0,1) under the
 null that the models are indistinguishible)
-------------------------------------------------------------
              Vuong z-statistic             H_A p-value
Raw                   0.2311493 model1 &gt; model2  0.4086
AIC-corrected         0.2311493 model1 &gt; model2  0.4086
BIC-corrected         0.2311493 model1 &gt; model2  0.4086
NULL</code></pre>
<p>#Dispersed Poisson Data</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">x &lt;-<span class="st"> </span>x  <span class="co">#disperse the data</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">mu &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(beta0 <span class="op">+</span><span class="st"> </span>beta1 <span class="op">*</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">y &lt;-<span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">rpois</a></span>(<span class="dt">n =</span> n, <span class="dt">lambda =</span> mu)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">modelling_data_dispersed &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5"></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="kw">pander</span>(<span class="kw">summarize</span>(modelling_data_dispersed), <span class="dt">caption =</span> <span class="st">"Synthtic Data : Summary Statistics"</span>)</a></code></pre></div>
<table class="table">
<caption>Synthtic Data : Summary Statistics</caption>
<colgroup>
<col width="5%">
<col width="9%">
<col width="4%">
<col width="11%">
<col width="11%">
<col width="4%">
<col width="8%">
<col width="9%">
<col width="12%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th></th>
<th align="center">N</th>
<th></th>
<th align="center">Mean</th>
<th align="center">SD</th>
<th></th>
<th align="center">Min</th>
<th align="center">Q1</th>
<th align="center">Median</th>
<th align="center">Q3</th>
<th align="center">Max</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>y</td>
<td align="center">1000</td>
<td></td>
<td align="center">26.12</td>
<td align="center">17.09</td>
<td></td>
<td align="center">0</td>
<td align="center">12</td>
<td align="center">21</td>
<td align="center">36</td>
<td align="center">96</td>
</tr>
<tr class="even">
<td>x</td>
<td align="center">1000</td>
<td></td>
<td align="center">4.97</td>
<td align="center">2.92</td>
<td></td>
<td align="center">0</td>
<td align="center">2.32</td>
<td align="center">4.9</td>
<td align="center">7.46</td>
<td align="center">10</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> modelling_data_dispersed) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">bin.count &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">h.y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/invisible">invisible</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(modelling_data_dispersed<span class="op">$</span>x, <span class="dt">breaks =</span> bin.count, <span class="dt">plot =</span> <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">b &lt;-<span class="st"> </span>h.y[<span class="st">"breaks"</span>]</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">bc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rapply">rapply</a></span>(b, c)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">x_factor &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cut">cut</a></span>(modelling_data_dispersed<span class="op">$</span>x, bc)</a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(x_factor) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(x_factor)))</a>
<a class="sourceLine" id="cb34-7" data-line-number="7">modelling_data_dispersed<span class="op">$</span>x_factor &lt;-<span class="st"> </span>x_factor</a>
<a class="sourceLine" id="cb34-8" data-line-number="8"></a>
<a class="sourceLine" id="cb34-9" data-line-number="9">m1.poisson &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(univariate.model.formula, <span class="dt">data =</span> modelling_data_dispersed, </a>
<a class="sourceLine" id="cb34-10" data-line-number="10">    <span class="dt">family =</span> poisson)</a>
<a class="sourceLine" id="cb34-11" data-line-number="11"><span class="kw">pander</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.poisson))</a></code></pre></div>
<table class="table">
<colgroup>
<col width="25%">
<col width="15%">
<col width="18%">
<col width="13%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">2.11</td>
<td align="center">0.01652</td>
<td align="center">127.7</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1991</td>
<td align="center">0.002334</td>
<td align="center">85.28</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>(Dispersion parameter for poisson family taken to be 1 )</p>
<table class="table">
<colgroup>
<col width="29%">
<col width="38%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center">Null deviance:</td>
<td align="center">10903 on 999 degrees of freedom</td>
</tr>
<tr class="even">
<td align="center">Residual deviance:</td>
<td align="center">2892 on 998 degrees of freedom</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">beta_<span class="dv">0</span> &lt;-<span class="st"> </span>m1.poisson<span class="op">$</span>coefficients[<span class="st">"(Intercept)"</span>]</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">beta_<span class="dv">1</span> &lt;-<span class="st"> </span>m1.poisson<span class="op">$</span>coefficients[<span class="st">"x"</span>]</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"></a>
<a class="sourceLine" id="cb35-4" data-line-number="4">predicted.counts.irr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(<span class="dt">object =</span> m1.poisson))</a>
<a class="sourceLine" id="cb35-5" data-line-number="5">calculated.predicted.irr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(beta_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>beta_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>modelling_data_dispersed<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="co"># ggplot(data=data.frame(predicted.counts=predicted.counts.irr,</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="co"># calculated.predicted=calculated.predicted.irr),aes(x=calculated.predicted.irr,y=predicted.counts.irr))+geom_point()+ggtitle('QA</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="co"># plot - predicted versus hand calculated counts in rr scale')</span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9"></a>
<a class="sourceLine" id="cb35-10" data-line-number="10">m1.negbin &lt;-<span class="st"> </span><span class="kw">glm.nb</span>(univariate.model.formula, <span class="dt">data =</span> modelling_data_dispersed)</a>
<a class="sourceLine" id="cb35-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(m1.negbin)</a></code></pre></div>
<pre><code>
Call:  glm.nb(formula = univariate.model.formula, data = modelling_data_dispersed, 
    init.theta = 12.83986187, link = log)

Coefficients:
(Intercept)            x  
     2.1130       0.1985  

Degrees of Freedom: 999 Total (i.e. Null);  998 Residual
Null Deviance:      3822 
Residual Deviance: 1136     AIC: 7019</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">pander</span>(<span class="kw">lrtest</span>(m1.poisson, m1.negbin), <span class="dt">caption =</span> <span class="st">"LRT : Poisson vs Negative Binomial"</span>)</a></code></pre></div>
<table class="table">
<caption>LRT : Poisson vs Negative Binomial</caption>
<colgroup>
<col width="8%">
<col width="12%">
<col width="6%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">#Df</th>
<th align="center">LogLik</th>
<th align="center">Df</th>
<th align="center">Chisq</th>
<th align="center">Pr(&gt;Chisq)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2</td>
<td align="center">-3871</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">-3506</td>
<td align="center">1</td>
<td align="center">730.1</td>
<td align="center">8.345e-161</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">vuong</span>(m1.poisson, m1.negbin)</a></code></pre></div>
<pre><code>Vuong Non-Nested Hypothesis Test-Statistic: 
(test-statistic is asymptotically distributed N(0,1) under the
 null that the models are indistinguishible)
-------------------------------------------------------------
              Vuong z-statistic             H_A    p-value
Raw                   -8.740638 model2 &gt; model1 &lt; 2.22e-16
AIC-corrected         -8.740638 model2 &gt; model1 &lt; 2.22e-16
BIC-corrected         -8.740638 model2 &gt; model1 &lt; 2.22e-16</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">est.poisson &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="dt">Estimate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson), <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint</a></span>(m1.poisson))</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="kw">pander</span>(est.poisson, <span class="dt">caption =</span> <span class="st">"Poisson"</span>)</a></code></pre></div>
<table class="table">
<caption>Poisson</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">2.5 %</th>
<th align="center">97.5 %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">2.11</td>
<td align="center">2.077</td>
<td align="center">2.142</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1991</td>
<td align="center">0.1945</td>
<td align="center">0.2036</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">est.negbin &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="dt">Estimate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.negbin), <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint</a></span>(m1.negbin))</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw">pander</span>(est.negbin, <span class="dt">caption =</span> <span class="st">"negative binomial"</span>)</a></code></pre></div>
<table class="table">
<caption>negative binomial</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">2.5 %</th>
<th align="center">97.5 %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">2.113</td>
<td align="center">2.065</td>
<td align="center">2.161</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1985</td>
<td align="center">0.1908</td>
<td align="center">0.2062</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">plotTitle &lt;-<span class="st"> </span><span class="kw">TeX</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"residuals vs fitted : $$"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"_"</span>, <span class="st">"-"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(univariate.model.formula)), </a>
<a class="sourceLine" id="cb42-2" data-line-number="2">    <span class="st">"$$ model = glm poisson"</span>, <span class="dt">sep =</span> <span class="st">""</span>))</a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">fitted =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(m1.poisson), <span class="dt">residuals =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.poisson))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> fitted, <span class="dt">y =</span> residuals)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(plotTitle)</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">plotTitle &lt;-<span class="st"> </span><span class="kw">TeX</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"residuals vs fitted : $$"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"_"</span>, <span class="st">"-"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(univariate.model.formula)), </a>
<a class="sourceLine" id="cb43-2" data-line-number="2">    <span class="st">"$$ model = MASS glm.nb Negative Binomial"</span>, <span class="dt">sep =</span> <span class="st">""</span>))</a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">fitted =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(m1.negbin), <span class="dt">residuals =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.negbin))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> fitted, <span class="dt">y =</span> residuals)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(plotTitle)</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-21-2.png" width="700"></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sandwich)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">cov.m1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sandwich/topics/vcovHC">vcovHC</a></span>(m1.poisson, <span class="dt">type =</span> <span class="st">"HC0"</span>)</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">std.err &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(cov.m1))</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">r.est &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="dt">Estimate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson), <span class="st">`</span><span class="dt">Robust SE</span><span class="st">`</span> =<span class="st"> </span>std.err, <span class="st">`</span><span class="dt">Pr(&gt;|z|)</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">pnorm</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson)<span class="op">/</span>std.err), <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>), <span class="dt">LL =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6"><span class="st">    </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>std.err, <span class="dt">UL =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1.poisson) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>std.err)</a>
<a class="sourceLine" id="cb44-7" data-line-number="7"></a>
<a class="sourceLine" id="cb44-8" data-line-number="8"><span class="kw">pander</span>(r.est, <span class="dt">caption =</span> <span class="st">"SE corrected coefficients"</span>)</a></code></pre></div>
<table class="table">
<caption>SE corrected coefficients</caption>
<colgroup>
<col width="25%">
<col width="15%">
<col width="16%">
<col width="15%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Robust SE</th>
<th align="center">Pr(&gt;|z|)</th>
<th align="center">LL</th>
<th align="center">UL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">2.11</td>
<td align="center">0.02758</td>
<td align="center">0</td>
<td align="center">2.056</td>
<td align="center">2.164</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">0.1991</td>
<td align="center">0.003937</td>
<td align="center">0</td>
<td align="center">0.1913</td>
<td align="center">0.2068</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">dp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.poisson, <span class="dt">type =</span> <span class="st">"pearson"</span>)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>m1.poisson<span class="op">$</span>df.res</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(dp) &lt;-<span class="st"> "dispersion parameter"</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3">dp</a></code></pre></div>
<pre><code>dispersion parameter 
            2.821115 </code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.poisson, <span class="dt">dispersion =</span> dp)</a></code></pre></div>
<pre><code>
Call:
glm(formula = univariate.model.formula, family = poisson, data = modelling_data_dispersed)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-5.6393  -1.2734  -0.0754   1.0623   5.4886  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 2.109631   0.027751   76.02   &lt;2e-16 ***
x           0.199059   0.003921   50.77   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 2.821115)

    Null deviance: 10903  on 999  degrees of freedom
Residual deviance:  2892  on 998  degrees of freedom
AIC: 7746.7

Number of Fisher Scoring iterations: 4</code></pre>
<p>Notice that the estimation of the dispersion and the regression parameters is independent, so choosing a dispersion other than one does not affect the regression parameter estimates.</p>
<p>We can also achieve the same effect by fitting a quasi-Poisson model directly using <code>glm</code>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">m1.quasipoisson &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(univariate.model.formula, <span class="dt">data =</span> modelling_data_dispersed, </a>
<a class="sourceLine" id="cb49-2" data-line-number="2">    <span class="dt">family =</span> quasipoisson)</a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.quasipoisson)</a></code></pre></div>
<pre><code>
Call:
glm(formula = univariate.model.formula, family = quasipoisson, 
    data = modelling_data_dispersed)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-5.6393  -1.2734  -0.0754   1.0623   5.4886  

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2.109631   0.027751   76.02   &lt;2e-16 ***
x           0.199059   0.003921   50.77   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasipoisson family taken to be 2.821134)

    Null deviance: 10903  on 999  degrees of freedom
Residual deviance:  2892  on 998  degrees of freedom
AIC: NA

Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(m1.quasipoisson) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(m1.quasipoisson), <span class="dt">pch =</span> <span class="st">"."</span>, <span class="dt">main =</span> <span class="kw">TeX</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"residuals vs fitted : $$"</span>, </a>
<a class="sourceLine" id="cb51-2" data-line-number="2">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"_"</span>, <span class="st">"-"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(univariate.model.formula)), <span class="st">"$$ model = quasi-Poisson"</span>, </a>
<a class="sourceLine" id="cb51-3" data-line-number="3">    <span class="dt">sep =</span> <span class="st">""</span>)))</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div id="zero-inflated-models-1" class="section level1">
<h1 class="hasAnchor">
<a href="#zero-inflated-models-1" class="anchor"></a>Zero-inflated models</h1>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">600</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dt">n =</span> n, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb52-3" data-line-number="3">mu &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(beta0 <span class="op">+</span><span class="st"> </span>beta1 <span class="op">*</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb52-4" data-line-number="4">y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">rpois</a></span>(<span class="dt">n =</span> n, <span class="dt">lambda =</span> mu)</a>
<a class="sourceLine" id="cb52-5" data-line-number="5"></a>
<a class="sourceLine" id="cb52-6" data-line-number="6">n0 &lt;-<span class="st"> </span><span class="dv">400</span></a>
<a class="sourceLine" id="cb52-7" data-line-number="7">x0 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dt">n =</span> n0, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb52-8" data-line-number="8">y0 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>, <span class="dv">400</span>)</a>
<a class="sourceLine" id="cb52-9" data-line-number="9"></a>
<a class="sourceLine" id="cb52-10" data-line-number="10">modelling_data_zeroinflated &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(y0, y), <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(x0, x))</a>
<a class="sourceLine" id="cb52-11" data-line-number="11"></a>
<a class="sourceLine" id="cb52-12" data-line-number="12"><span class="kw">ggplot</span>(<span class="dt">data =</span> modelling_data_zeroinflated) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))</a></code></pre></div>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">m1.poisson.zi &lt;-<span class="st"> </span><span class="kw">zeroinfl</span>(univariate.model.formula, <span class="dt">data =</span> modelling_data_zeroinflated, </a>
<a class="sourceLine" id="cb53-2" data-line-number="2">    <span class="dt">dist =</span> <span class="st">"poisson"</span>)</a>
<a class="sourceLine" id="cb53-3" data-line-number="3"></a>
<a class="sourceLine" id="cb53-4" data-line-number="4">m1.negbin.zi &lt;-<span class="st"> </span><span class="kw">zeroinfl</span>(univariate.model.formula, <span class="dt">data =</span> modelling_data_zeroinflated, </a>
<a class="sourceLine" id="cb53-5" data-line-number="5">    <span class="dt">dist =</span> <span class="st">"negbin"</span>)</a>
<a class="sourceLine" id="cb53-6" data-line-number="6"></a>
<a class="sourceLine" id="cb53-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.poisson.zi))</a></code></pre></div>
<pre><code>
Call:
zeroinfl(formula = univariate.model.formula, data = modelling_data_zeroinflated, 
    dist = "poisson")

Pearson residuals:
    Min      1Q  Median      3Q     Max 
-2.0090 -0.6634 -0.3356  0.5800  4.7714 

Count model coefficients (poisson with log link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 0.992692   0.038495   25.79   &lt;2e-16 ***
x           0.202937   0.005518   36.77   &lt;2e-16 ***

Zero-inflation model coefficients (binomial with logit link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.98048    0.16190   12.23   &lt;2e-16 ***
x           -0.88209    0.06316  -13.97   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Number of iterations in BFGS optimization: 10 
Log-likelihood: -1830 on 4 Df</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1.negbin.zi))</a></code></pre></div>
<pre><code>
Call:
zeroinfl(formula = univariate.model.formula, data = modelling_data_zeroinflated, 
    dist = "negbin")

Pearson residuals:
    Min      1Q  Median      3Q     Max 
-2.0084 -0.6631 -0.3353  0.5797  4.7734 

Count model coefficients (negbin with log link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  0.99291    0.03850  25.790   &lt;2e-16 ***
x            0.20291    0.00552  36.759   &lt;2e-16 ***
Log(theta)   9.52792   10.07232   0.946    0.344    

Zero-inflation model coefficients (binomial with logit link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.98204    0.16196   12.24   &lt;2e-16 ***
x           -0.88257    0.06318  -13.97   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Theta = 13738.0472 
Number of iterations in BFGS optimization: 23 
Log-likelihood: -1830 on 5 Df</code></pre>
<p>Fitted versus residuals for the zero-inflated class of model.</p>
<p><img src="count-regression-vignette_files/figure-html/unnamed-chunk-27-1.png" width="700"><img src="count-regression-vignette_files/figure-html/unnamed-chunk-27-2.png" width="700"></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw">vuong</span>(m1.poisson.zi, m1.negbin.zi))</a></code></pre></div>
<pre><code>Vuong Non-Nested Hypothesis Test-Statistic: 
(test-statistic is asymptotically distributed N(0,1) under the
 null that the models are indistinguishible)
-------------------------------------------------------------
              Vuong z-statistic             H_A p-value
Raw                   0.5778354 model1 &gt; model2 0.28169
AIC-corrected         0.5778354 model1 &gt; model2 0.28169
BIC-corrected         0.5778354 model1 &gt; model2 0.28169
NULL</code></pre>
<p>#Bibliography</p>
<div id="refs" class="references">
<div id="ref-CameronTrivedi">
<p>Cameron, Colin. 2012. “Microeconometrics Using Stata, by a. Colin Cameron and Pravin K. Trivedi (Stata Press, College Station, Texas, Usa, 2009), Pp. Xl + 692.” <em>Economic Record</em> 88 (283): 595–96. <a href="https://doi.org/10.1111/1475-4932.12006">https://doi.org/10.1111/1475-4932.12006</a>.</p>
</div>
<div id="ref-BovengVerHoef">
<p>Ver Hoef, Jay M., and Peter L. Boveng. 2007. “QUASI-Poisson Vs. NEGATIVE Binomial Regression: HOW Should We Model Overdispersed Count Data?” <em>Ecology</em> 88 (11): 2766–72. <a href="https://doi.org/10.1890/07-0043.1">https://doi.org/10.1890/07-0043.1</a>.</p>
</div>
<div id="ref-vuong">
<p>Vuong, Quang H. 1989. “Likelihood Ratio Tests for Model Selection and Non-Nested Hypotheses.” <em>Econometrica</em> 57 (2). [Wiley, Econometric Society]: 307–33. <a href="http://www.jstor.org/stable/1912557">http://www.jstor.org/stable/1912557</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#zero-inflated-models">zero-inflated models</a></li>
      <li><a href="#zero-inflated-models-1">Zero-inflated models</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bruce Campbell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
